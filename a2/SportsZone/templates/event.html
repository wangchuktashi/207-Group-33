{% extends "base.html" %}
{% block title %}{{ event.title }} Â· SportsZone{% endblock %}

{% block extra_css %}
<style>
  /* --- Hero --- */
  .event-hero{
    position:relative;width:100%;max-height:500px;overflow:hidden;
    border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.25);margin-top:10px;
  }
  .hero-banner{width:100%;height:100%;object-fit:cover;display:block;filter:brightness(.88);transition:transform .5s ease;}
  .event-hero:hover .hero-banner{transform:scale(1.05);}
  .hero-overlay{position:absolute;bottom:20px;left:20px;color:#fff;text-shadow:0 2px 6px rgba(0,0,0,.7);}
  .hero-title{font-size:2rem;font-weight:700;margin:0;}
  .hero-subtitle{font-size:1rem;margin-top:.25rem;margin-bottom:0;}

  /* --- Section polish --- */
  .section-title{
    display:flex;align-items:center;gap:.75rem;margin:1.5rem 0 .75rem;
    font-weight:700;color:#0f2f28;
  }
  .section-title::after{content:"";height:1px;flex:1;background:rgba(0,0,0,.08);}

  .info-list{margin:0;padding:0}
  .info-list dt{width:130px;float:left;clear:left;font-weight:600;color:#0f2f28;padding:.45rem 0;}
  .info-list dd{margin-left:140px;padding:.45rem 0;color:#111827;}

  .empty-state{background:#fff;border:1px dashed #cceee0;color:#0f2f28;padding:.85rem 1rem;border-radius:10px;}
  .comment-card{background:#fff;border:1px solid rgba(0,0,0,.06);border-radius:14px;padding:1rem;box-shadow:0 8px 20px rgba(0,0,0,.08);}

  /* Booking panel */
  @media (min-width:992px){ .sticky-side{position:sticky;top:1rem;} }
  .booking-card{background:#fff;border:1px solid rgba(0,0,0,.06);border-radius:16px;box-shadow:0 16px 32px rgba(0,0,0,.12);padding:1.25rem;}
  .booking-card h3{font-size:1.05rem;font-weight:700;margin:0 0 .75rem;}
  .booking-meta{font-size:.92rem;color:#6b7280;margin-bottom:.75rem;}
  .booking-card .form-label{font-weight:600;color:#0f2f28;}
  .booking-card .btn-primary{padding:.65rem 1rem;font-weight:600;border-radius:10px;}
  .form-control:focus,.form-select:focus{box-shadow:0 0 0 .2rem rgba(13,110,253,.15);}

  @media (max-width: 991px){
    .info-list dt{width:110px}
    .info-list dd{margin-left:120px}
  }

  /* --- Action strip (low inventory + share) --- */
  .event-actions{display:flex;justify-content:space-between;align-items:center;gap:.75rem;margin:.75rem 0 1rem;}
  .low-inventory{display:inline-flex;align-items:center;gap:.5rem;background:#ffefed;border:1px solid #ffd9d4;color:#0f172a;border-radius:14px;padding:.35rem .6rem;font-weight:700;}
  .low-inventory .flame{font-size:1rem;line-height:1;}
  .icon-btn{--btn-color:#3b5bff;display:inline-flex;align-items:center;justify-content:center;width:38px;height:38px;border-radius:10px;border:1px solid #dfe6ff;background:#f4f7ff;color:var(--btn-color);text-decoration:none;cursor:pointer}
  .icon-btn:hover{background:#eef3ff;border-color:#cfd9ff}
  .icon-btn svg{width:20px;height:20px;display:block}

  /* --- CSS-only Share Modal (via :target) --- */
  .share-modal{
    position:fixed;inset:0;display:none;align-items:center;justify-content:center;
    background:rgba(0,0,0,.35);z-index:1060;padding:1rem;
  }
  .share-modal:target{display:flex;}
  .share-dialog{
    width:100%;max-width:640px;background:#fff;border-radius:16px;
    box-shadow:0 24px 64px rgba(0,0,0,.25);padding:1.25rem 1.25rem 1rem;
  }
  .share-close{
    position:absolute;right:1.25rem;top:1rem;color:#94a3b8;text-decoration:none;
    font-size:2rem;line-height:1;
  }
  .share-title{font-size:1.15rem;font-weight:700;margin:0 0 .75rem;color:#0f2f28;}
  .share-icons{display:flex;gap:.75rem;align-items:center;margin:.5rem 0 1rem;}
  .share-circle{
    width:44px;height:44px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;
    border:1px solid #e5e7eb;background:#f8fafc;color:#334155;text-decoration:none;font-weight:800;
  }
  .share-circle:hover{background:#eef2ff;border-color:#dbeafe;color:#1e40af;}
  .share-label{display:block;margin:.25rem 0 .25rem;font-size:.85rem;color:#64748b;}
  .share-url{display:flex;gap:.5rem;align-items:stretch}
  .share-url input{flex:1;border:1px solid #e5e7eb;border-radius:10px;padding:.65rem .75rem}
  .share-open{display:inline-flex;align-items:center;justify-content:center;width:42px;border:1px solid #e5e7eb;border-radius:10px}
  .share-open svg{width:20px;height:20px}
</style>
{% endblock %}

{% block body %}
<!-- Hero banner -->
<div class="event-hero mb-3">
  <img
    src="{{ url_for('static', filename='img/' ~ (event.hero_image or event.image or 'placeholder.jpg')) }}"
    alt="{{ event.title }}"
    class="img-fluid hero-banner">
  <div class="hero-overlay">
    <h1 class="hero-title">{{ event.title }}</h1>
    <p class="hero-subtitle">{{ event.venue_text }}</p>
  </div>
</div>

<!-- Action strip -->
<div class="container">
  <div class="event-actions">
    {% if event.status == 'Open' and (event.tickets_left is defined and event.tickets_left <= 30) %}
      <span class="low-inventory"><span class="flame">ðŸ”¥</span> Few tickets left</span>
    {% endif %}
    <div class="d-flex align-items-center gap-2">
      <!-- Share opens CSS-only modal -->
      <a class="icon-btn" href="#share-modal" title="Share">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 16V7m0 0l-4 4m4-4l4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M7 16h10v3a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2v-3z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </a>
    </div>
  </div>
</div>

{# Teams (derived from title like "Team A vs Team B") #}
{% set teams = event.title.split(' vs ') %}
{% if teams|length == 2 %}
<div class="d-flex justify-content-center align-items-center gap-4 mb-2">
  <div class="text-center"><div class="small fw-bold">{{ teams[0] }}</div></div>
  <div class="h4 mb-0">vs</div>
  <div class="text-center"><div class="small fw-bold">{{ teams[1] }}</div></div>
</div>
{% endif %}

<!-- Badges + meta -->
<div class="d-flex flex-wrap justify-content-center align-items-center gap-2">
  <span class="badge text-bg-primary">{{ event.sport }}</span>
  <span class="badge text-bg-{{ event.badge }} badge-status">{{ event.status }}</span>
</div>
<p class="text-muted mb-3 text-center">
  {{ event.start_text }}{% if event.end_text %} â€“ {{ event.end_text }}{% endif %} Â· {{ event.venue_text }}
</p>

<div class="row g-4">
  <!-- LEFT: About + Comments -->
  <div class="col-lg-8">
    <!-- About -->
    <h2 class="section-title">About this event</h2>

    <!--event description -->
   {% if event.description %}
  <p class="lead">{{ event.description }}</p>
{% endif %}


    <dl class="info-list clearfix">
      <dt>Venue</dt><dd>{{ event.venue_text }}</dd>
      <dt>Start</dt><dd>{{ event.start_text }}</dd>
      {% if event.end_text %}<dt>End</dt><dd>{{ event.end_text }}</dd>{% endif %}
      {% if teams|length == 2 %}<dt>Home / Away</dt><dd>{{ teams[0] }} vs {{ teams[1] }}</dd>{% endif %}
    </dl>

    <!-- CSS-only Share Modal -->
    <div id="share-modal" class="share-modal" aria-hidden="true">
      <div class="share-dialog" role="dialog" aria-modal="true" aria-labelledby="share-title">
        <a class="share-close" href="#" aria-label="Close">&times;</a>

        <h3 id="share-title" class="share-title">Share with friends</h3>

        <div class="share-icons">
          <a class="share-circle" target="_blank" rel="noopener"
             href="https://www.facebook.com/sharer/sharer.php?u={{ request.url|urlencode }}"
             aria-label="Share on Facebook">f</a>

          <a class="share-circle" target="_blank" rel="noopener"
             href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.url|urlencode }}"
             aria-label="Share on LinkedIn">in</a>

          <a class="share-circle" target="_blank" rel="noopener"
             href="https://twitter.com/intent/tweet?text={{ event.title|urlencode }}&url={{ request.url|urlencode }}"
             aria-label="Share on X/Twitter">x</a>

          <a class="share-circle" target="_blank" rel="noopener"
             href="mailto:?subject={{ event.title|urlencode }}&body={{ request.url|urlencode }}"
             aria-label="Share via Email">@</a>
        </div>

        <label class="share-label">Event URL</label>
        <div class="share-url">
          <input type="text" value="{{ request.url }}" readonly>
          <a class="share-open" target="_blank" rel="noopener" href="{{ request.url }}" aria-label="Open link">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M14 3h7v7M10 14L21 3M21 10v7a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V7a4 4 0 0 1 4-4h7"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </a>
        </div>
      </div>
    </div>

    <!-- Comments -->
    <h2 class="section-title mt-4">Comments</h2>

    {% if event.comments and event.comments|length > 0 %}
      <ul class="list-group mb-3">
        {% for c in event.comments %}
          <li class="list-group-item d-flex flex-column">
            <div class="small text-muted">
              <strong>{{ (c.user.first_name if c.user else 'Anon') }}</strong> Â· {{ c.created_at }}
            </div>
            <div>{{ c.text }}</div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="empty-state mb-3">No comments yet</div>
    {% endif %}

    <!-- Demo comment form (disabled submit) -->
    <div class="comment-card">
      <div class="mb-2 fw-semibold">Add a comment</div>
      <div class="row g-2">
        <div class="col-md-4">
          <label class="form-label">Your name</label>
          <input type="text" class="form-control" placeholder="e.g., Jack" required>
        </div>
        <div class="col-12">
          <label class="form-label">Comment</label>
          <textarea class="form-control" rows="3" placeholder="Write your commentâ€¦" required></textarea>
        </div>
        <div class="col-12">
          <button class="btn btn-outline-primary" type="button" disabled>Post Comment</button>
        </div>
      </div>
    </div>
  </div>

  <!-- RIGHT: Booking panel -->
  <aside class="col-lg-4">
    {% set can_book = (event.status == 'Open') %}
    <div class="booking-card sticky-side">
      <h3>Book Tickets</h3>
      <div class="booking-meta">
        {% if can_book %}
          Tickets available: <strong>{{ event.tickets_left if event.tickets_left is defined else 120 }}</strong>
        {% else %}
          <strong>Booking unavailable ({{ event.status }})</strong>
        {% endif %}
      </div>

      <form method="POST" action="{{ url_for('main.create_booking') }}">
        {{ form.hidden_tag() }}
        <label class="form-label">{{ form.ticket_type.label }}</label>
        {{ form.ticket_type(class="form-select mb-3", disabled=not can_book) }}

        <label class="form-label">{{ form.quantity.label }}</label>
        {{ form.quantity(class="form-control mb-3", min="1", disabled=not can_book) }}

        {{ form.submit(class="btn btn-primary w-100 mb-3", disabled=not can_book) }}
      </form>

      <a class="btn btn-outline-secondary w-100" href="{{ url_for('main.booking') }}">
        View Booking History
      </a>
    </div>
  </aside>
</div>
{% endblock %}
