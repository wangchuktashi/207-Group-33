{% extends "base.html" %}
{% block title %}My Events · SportsZone{% endblock %}


{% block body %}
<div class="my-events-page">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h1 class="page-title m-0">My Events</h1>
    <a href="{{ url_for('main.create_event') }}" class="btn btn-primary">Create New Event</a>
  </div>

  {% if events %}
    {% set badge_map = {'Open':'primary','Sold Out':'danger','Cancelled':'secondary','Inactive':'warning'} %}
    <div class="row g-3">
      {% for e in events %}
        <div class="col-12 col-md-6 col-lg-4">
          <article class="event-card">
            <!-- image -->
            <div class="thumb-wrap">
              {% if e.event_image %}
                <img class="thumb" src="{{ url_for('static', filename='img/' ~ e.event_image) }}" alt="{{ e.event_title }}">
              {% else %}
                <div class="thumb d-flex align-items-center justify-content-center text-uppercase fw-bold"
                     style="background:#c8f6ef;color:#0f2f28;font-size:2rem;">
                  {{ e.event_title[:1] if e.event_title else 'E' }}
                </div>
              {% endif %}
            </div>

            <!-- content -->
            <div class="body">
              <div class="d-flex align-items-start justify-content-between flex-wrap gap-2 mb-2">
                <h2 class="title">{{ e.event_title }}</h2>
                <span class="badge text-bg-{{ badge_map.get(e.status,'secondary') }}">{{ e.status }}</span>
              </div>
              <div class="meta">
                {{ e.sports_type or 'sport' }}<br>
                {% if e.start_datetime %}{{ e.start_datetime.strftime('%d %b %Y, %I:%M %p') }}{% endif %}<br>
                {% if e.venue %}{{ e.venue.venue_name }}{% endif %}
              </div>
            </div>

            <!-- actions footer (always visible) -->
            <div class="card-footer">
              <div class="actions d-flex flex-wrap gap-2">
                <a href="{{ url_for('main.view_event', event_id=e.id) }}"
                   class="btn btn-outline-secondary btn-sm">View</a>

                <a href="{{ url_for('main.create_event', event_id=e.id) }}"
                   class="btn btn-primary btn-sm">Edit</a>

                <form method="POST"
                      action="{{ url_for('main.cancel_event', event_id=e.id) }}"
                      onsubmit="return confirm('Cancel this event? This will stop further bookings.');"
                      class="d-inline">
                  {{ csrf_token() if csrf_token is defined else '' }}
                  <button class="btn btn-outline-danger btn-sm"
                          {% if e.status == 'Cancelled' %}disabled{% endif %}>
                    Cancel
                  </button>
                </form>
              </div>
            </div>
          </article>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-info mt-3">You haven’t created any events yet.</div>
  {% endif %}
</div>
{% endblock %}
