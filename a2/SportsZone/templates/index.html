{% extends "base.html" %}
{% block title %}Home · SportsZone{% endblock %}

{% block extra_css %}
<style>
  .hero-img{width:100%;height:65vh;object-fit:cover;object-position:top;}
</style>
{% endblock %}

{% block body %}
<!-- Hero Carousel -->
<div id="miniHero" class="carousel slide hero" data-bs-ride="carousel" data-bs-interval="4200">
  <div class="carousel-indicators">
    <button type="button" data-bs-target="#miniHero" data-bs-slide-to="0" class="active" aria-current="true"></button>
    <button type="button" data-bs-target="#miniHero" data-bs-slide-to="1"></button>
    <button type="button" data-bs-target="#miniHero" data-bs-slide-to="2"></button>
  </div>

  <div class="carousel-inner">
    <div class="carousel-item active">
      <img class="item-img" src="{{ url_for('static', filename='img/carousel1.jpg') }}" alt="Football">
      <div class="carousel-caption text-start">
        <h5 class="fw-bold mb-1">International Football</h5>
        <small>Weekend match under lights.</small>
      </div>
    </div>
    <div class="carousel-item">
      <img class="item-img" src="{{ url_for('static', filename='img/carousel2.jpg') }}" alt="Basketball">
      <div class="carousel-caption text-start">
        <h5 class="fw-bold mb-1">Basketball League</h5>
        <small>Fast breaks. Big plays.</small>
      </div>
    </div>
    <div class="carousel-item">
      <img class="item-img" src="{{ url_for('static', filename='img/carousel3.jpg') }}" alt="Tennis">
      <div class="carousel-caption text-start">
        <h5 class="fw-bold mb-1">Tennis Championship</h5>
        <small>Don’t miss the clash.</small>
      </div>
    </div>
  </div>

  <button class="carousel-control-prev" type="button" data-bs-target="#miniHero" data-bs-slide="prev">
    <span class="carousel-control-prev-icon"></span>
    <span class="visually-hidden">Prev</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#miniHero" data-bs-slide="next">
    <span class="carousel-control-next-icon"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>

<!-- Browse + Search toolbar -->
<div class="container pt-4">
  <div class="toolbar shadow-sm rounded-4 px-3 py-3">
    {% set cat = request.args.get('category', 'all') %}
    {% set st  = request.args.get('status', 'all') %}
    {% set q   = request.args.get('q', '') %}

    <!-- Categories -->
    <div class="btn-group flex-wrap" role="group" aria-label="Browse by category">
      <a class="btn cat-btn {{ 'active' if cat=='all' else '' }}" href="{{ url_for('main.index') }}">All</a>
      <a class="btn cat-btn {{ 'active' if cat=='football' else '' }}" href="{{ url_for('main.index', category='football', status=st, q=q) }}">Football</a>
      <a class="btn cat-btn {{ 'active' if cat=='basketball' else '' }}" href="{{ url_for('main.index', category='basketball', status=st, q=q) }}">Basketball</a>
      <a class="btn cat-btn {{ 'active' if cat=='cricket' else '' }}" href="{{ url_for('main.index', category='cricket', status=st, q=q) }}">Cricket</a>
      <a class="btn cat-btn {{ 'active' if cat=='tennis' else '' }}" href="{{ url_for('main.index', category='tennis', status=st, q=q) }}">Tennis</a>
    </div>

    <!-- Status -->
    <div class="btn-group flex-wrap ms-3" role="group" aria-label="Browse by status">
      <a class="btn cat-btn {{ 'active' if st=='all' else '' }}" href="{{ url_for('main.index', category=cat, q=q) }}">All Status</a>
      <a class="btn cat-btn {{ 'active' if st=='open' else '' }}" href="{{ url_for('main.index', category=cat, status='open', q=q) }}">Open</a>
      <a class="btn cat-btn {{ 'active' if st=='soldout' else '' }}" href="{{ url_for('main.index', category=cat, status='soldout', q=q) }}">Sold Out</a>
      <a class="btn cat-btn {{ 'active' if st=='cancelled' else '' }}" href="{{ url_for('main.index', category=cat, status='cancelled', q=q) }}">Cancelled</a>
      <a class="btn cat-btn {{ 'active' if st=='inactive' else '' }}" href="{{ url_for('main.index', category=cat, status='inactive', q=q) }}">Inactive</a>
    </div>

    <!-- Search -->
    <form class="ms-auto" role="search" method="get" action="{{ url_for('main.index') }}" style="min-width:250px; max-width:350px;">
      <input type="hidden" name="category" value="{{ cat }}">
      <input type="hidden" name="status" value="{{ st }}">
      <div class="input-group input-group-sm">
        <input class="form-control search-box" type="search" name="q" value="{{ q }}" placeholder="Search events.." aria-label="Search events">
        <button class="btn btn-primary search-btn" type="submit">Go</button>
      </div>
    </form>
  </div>
</div>

<!-- Events grid -->
<div class="container py-4">
  {% set badge_map = {'Open':'primary','Sold Out':'danger','Cancelled':'secondary','Inactive':'warning'} %}
  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4">
    {% for e in events %}
      <div class="col event" data-category="{{ (e.sports_type or '')|lower }}" data-status="{{ (e.status or '')|lower }}">
        <div class="card h-100">
          <div class="card-media">
            <img src="{{ url_for('static', filename='img/' ~ (e.event_image or 'placeholder.jpg')) }}"
                 alt="{{ e.event_title or e.sports_type or 'Event' }}">
          </div>
          <div class="card-body d-flex flex-column">
            <div class="d-flex justify-content-between mb-2">
              <span class="badge text-bg-primary">{{ e.sports_type }}</span>
              <span class="badge text-bg-{{ badge_map.get(e.status, 'secondary') }}">{{ e.status }}</span>
            </div>
            <h5 class="card-title mb-1">{{ e.event_title }}</h5>
            <p class="card-text text-muted small mb-2">
              <strong>{{ e.start_datetime.strftime('%a %d %b %Y · %I:%M %p') if e.start_datetime else '' }}</strong><br>
              {{ e.venue_text }}
            </p>
            <a href="{{ url_for('main.view_event', event_id=e.id) }}" class="btn btn-primary mt-auto">View Details</a>
          </div>
        </div>
      </div>
    {% else %}
      <div class="col">
        <div class="alert alert-info mb-0">No events found.</div>
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
